# Openmaize-phoenix

The latest version of Openmaize depends on Elixir 1.2.

Example of using Openmaize authentication library in a Phoenix web
application.

In this example:

* there are multiple users and one admin
* authentication is performed for every page
  * even unprotected pages authenticate the user
* authorization is based on roles and the user id

## Openmaize

If you want to use this repository as an example of how to use Openmaize,
the most important files to look at are:

* config/dev.exs
  * configuring Openmaize and OpenmaizeJWT
* web/router.ex
  * authentication using Openmaize.Authenticate
    * authenticates the user using JSON Web Tokens
    * sets the `current_user` value - if no user is found, this is set to nil
* web/controllers/authorize.ex
  * custom functions to handle authorization
    * this file can be generated by calling `mix openmaize.gen.phoenixauth`
    * see the documentation for `openmaize.gen.phoenixauth` for details
* web/controllers/admin_controller.ex
  * authorization - using the functions defined in the `authorize.ex` file
* web/controllers/page_controller.ex
  * login and logout using Openmaize.Login and Openmaize.Logout
  * email confirmation using Openmaize.ConfirmEmail
  * password reset using Openmaize.ResetPassword
* web/controllers/user_controller.ex
  * authorization - using the functions defined in the `authorize.ex` file
* web/models/openmaize_ecto.ex
  * functions used by openmaize to call the database using Ecto
    * this file can be generated by calling `mix openmaize.gen.ectodb`
* web/models/user.ex
  * new user creation - together with the `create` function in the admin_controller file
* web/templates/page/login.html.eex
  * the login form

### Optional password strength checker

This example uses a password strength checker which is an optional dependency of
Openmaize. If you don't want to use this, just remove the line `{:not_qwerty123, "~> 1.0"}`
from the deps in the mix.exs file.

## Installation

Follow these instructions to install this Phoenix app:

Edit the `config/dev.exs` and `priv/repo/seeds.exs` files before setting up the database
and then run the following commands:

    mix deps.get
    mix ecto.setup
    npm install
    mix phoenix.server

This app uses Stylus as a css preprocessor. If you don't want to use Stylus, remove
`stylus-brunch`, `jeet` and `rupture` from the package.json file before running
`npm install` and remove the stylus entry in the `brunch-config.js` file.

If you want to run Sass as a css preprocessor, run the following command:

    npm install --save sass-brunch

### License

MIT.
